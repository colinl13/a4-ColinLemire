<!doctype html>
<html lang='en'>
  <head>
    <meta charset="UTF-8">
    <title>Web Audio Visualizer</title>
    <!-- <style>
      body { background: #222; color: #fff; text-align: center; }
      canvas { display: block; margin: 2em auto; background: #000; }
      button { font-size: 1.2em; margin-top: 2em; }
    </style> -->
  </head>
  <body>
    <h1>Web Audio + Canvas Visualizer</h1>
    <button>Start Visualizer</button>
    <script>
      const start = function() {
        document.body.innerHTML = '';
        const canvas = document.createElement('canvas');
        document.body.appendChild(canvas);
        canvas.width = canvas.height = 512;
        const ctx = canvas.getContext('2d');

        // audio init
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = audioCtx.createOscillator();
        osc.type = 'sawtooth';
        osc.frequency.value = 220;
        osc.start();

        const gainNode = audioCtx.createGain();
        gainNode.gain.value = 0.1;
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        const analyser = audioCtx.createAnalyser();
        analyser.fftSize = 1024;
        osc.connect(analyser);

        const results = new Uint8Array(analyser.frequencyBinCount);

        function draw() {
          window.requestAnimationFrame(draw);
          ctx.fillStyle = 'black';
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = 'lime';
          analyser.getByteFrequencyData(results);
          for (let i = 0; i < analyser.frequencyBinCount; i++) {
            ctx.fillRect(i, canvas.height - results[i], 1, results[i]);
          }
        }
        draw();
      };
      window.onload = () => document.querySelector('button').onclick = start;
    </script>
  </body>
</html>
